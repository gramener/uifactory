<template $name="bs5-input" name="" type="text" label="" placeholder="" bs5-class="" maxlength:number="" default="" media=""
  items:array="" height:number="" help="" html-content="" prefix="" suffix="" layout="">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

  <style>
    bs5-input {
      display: block;
    }
    /* TODO: Should these be global, given that it should be theme-based? */
    bs5-input {
      --box-shadow: 0px 2px 4px #d3d3d3;
      --text-color: #212529;
      --border-color: #cecece;
      --error: #dc3545;
      --placeholder-color: rgb(117, 117, 117);
      --focus-blue: #0d6efd;
      --focus-bg-grey: #c2bfbf2d;
      --upload_file-bg: rgba(26, 118, 189, 0.1);
      --upload-file-border: rgba(126, 170, 205, 0.5);
      --btn-primary: #1979C2;
      --txt-white: #fff;
      --white-bg: #fff;
      --secondary-color: #1979C2;
    }

    bs5-input[shadow] input:hover {
      box-shadow: var(--box-shadow)
    }

    bs5-input[shadow] input:focus {
      color: var(--text-color) !important;
      border-color: var(--border-color) !important;
      outline: 0 !important;
      box-shadow: var(--box-shadow) !important;
    }

    bs5-input[bs5-class=error] input {
      border-color: var(--error);
    }

    bs5-input[bs5-class=error] input:focus {
      border-color: var(--error) !important;
    }

    bs5-input input:focus::-webkit-input-placeholder {
      color: var(--placeholder-color) !important;
    }

    bs5-input[type="checkbox"] input:hover:enabled {
      border-color: var(--focus-blue);
    }

    bs5-input[shadow] textarea:hover {
      box-shadow: var(--box-shadow)
    }

    bs5-input[shadow][type="textarea"] :focus {
      color: var(--text-color) !important;
      border-color: var(--border-color) !important;
      outline: 0 !important;
      box-shadow: var(--box-shadow) !important;
    }

    bs5-input[type="textarea"][bs5-class=error] textarea {
      border-color: var(--error);
    }

    bs5-input[type="textarea"][bs5-class=error] textarea:focus {
      border-color: var(--error) !important;
    }

    bs5-input[type="textarea"] .badge {
      background-color: var(--white-bg);
      border: 1px solid var(--border-color);
      left: 90% !important;
      color: var(--bs-secondary) !important;
    }

    bs5-input[shadow][type="select"] :hover {
      box-shadow: var(--box-shadow)
    }

    bs5-input[shadow] .form-select:focus {
      color: var(--text-color) !important;
      border-color: var(--border-color) !important;
      outline: 0 !important;
      box-shadow: var(--box-shadow) !important;
    }

    bs5-input select option {
      background-color: var(--white-bg);
      color: rgb(0, 0, 0);
      top: 10em;
      border: 1px solid var(--border-color);
    }

    bs5-input[type="switch"] input:hover:enabled {
      border-color: var(--focus-blue);
    }

    bs5-input .dropdown-menu.show > * {
      display: block;
      padding: 5px 10px;
    }
  </style>

  <% let attrs = [
    this.hasAttribute('disabled') ? 'disabled' : '',
    this.hasAttribute('readonly') ? 'readonly' : ''
  ].join(' ') %>

  <% if (type.match(/^(text|email|password|number|search)$/)) { %>
    <% if (layout == 'inline' || layout == 'block'){ %>
      <% let placeTitle = layout == 'inline' ? 'col-sm-2' : '' %>
      <div class="form-group row">
        <label for="${this.$id}-input" class="<%- placeTitle %> col-form-label">${label}</label>
        <div class="col-sm-10">
          <div class="input-group">
            <% if (prefix) { %><span class="input-group-text">${prefix}</span><% } %>
            <input type="<%- type %>" id="${this.$id}-input" name="<%- name %>" placeholder="<%- placeholder %>" ${attrs} value="<%- obj.default %>"
              class="form-control <%- bs5Class %>" maxlength="<%- maxlength %>" aria-describedby="${this.$id}-help"
              style="background-image: url('<%- media %>') no-repeat right 5px top 3px"/>
            <% if (suffix) { %><span class="input-group-text">${suffix}</span><% } %>
          </div>
          <% if (help) { %><small id="${this.$id}-help" class="form-text text-muted">${help}</small><% } %>
        </div>
      </div>
    <% } else { %>
      <div class="form-floating mb-3">
        <input type="<%- type %>" name="<%- name %>" placeholder="<%- placeholder %>" ${attrs} value="<%- obj.default %>"
          class="form-control <%- bs5Class %>" maxlength="<%- maxlength %>" aria-describedby="${this.$id}-help"
          style="background-image: url('<%- media %>') no-repeat right 5px top 15px" />
        <% if (help) { %><small id="${this.$id}-help" class="form-text text-muted">${help}</small><% } %>
        <label>${label}</label>
      </div>
    <% } %>
  <% } else if (type =="textarea") { %>
    <div class="form-floating">
      <span class="position-absolute top-0 translate-middle badge">
        <span class="word-count"></span><% if (maxlength) { %> / <%- maxlength %><% } %>
      </span>
      <textarea class="form-control <%- bs5Class %>" placeholder="<%- placeholder %>" id="floatingTextarea2" ${attrs}
        style="height: <%- height %>px" aria-describedby="${this.$id}-help" maxlength="<%- maxlength %>">${obj.default}</textarea>
      <label for="floatingTextarea2">${label}</label>
      <% if (help) { %><small id="${this.$id}-help" class="form-text text-muted">${help}</small><% } %>
    </div>
  <% } else if (type == "select") { %>
    <select class="form-select <%- bs5Class %>" aria-describedby="${this.$id}-help" ${attrs}>
      <% for (var i = 0; i < items.length; i++) { %>
        <option value="<%- i %>"><%- items[i] %></option>
      <% } %>
    </select>
    <% if (help) { %><small id="${this.$id}-help" class="form-text text-muted">${help}</small><% } %>
  <% } else if (type == "checkbox" || type == "radio") { %>
    <% for (var i = 0; i < items.length; i++) { %>
      <% let checkedattr = obj.default.indexOf(items[i]) >= 0 %>
      <div class="form-check"><input class="form-check-input <%- bs5Class %>" type="<%- type %>" default="" id="${this.$id}-item${i}" name="<%- name %>" ${attrs} ${checkedattr}></div>
      <label class="form-check-label" for="${this.$id}-item${i}"><%- items[i] %></label>
      <br>
    <% } %>
  <% } else if (type == "switch") { %>
    <% for (var i = 0; i < items.length; i++) { %>
      <% let checkedattr = obj.default.indexOf(items[i]) >= 0 %>
      <div class="form-switch">
        <input class="form-check-input <%- bs5Class %>" type="checkbox" value="" id="${this.$id}-item${i}" name="<%- name %>" ${attrs} ${checkedattr}>
        <label class="form-check-label" for="${this.$id}-item${i}"><%- items[i] %></label>
      </div>
      <br>
    <% } %>
  <% } else if (type == "dropdown") { %>
    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle <%- bs5Class %>" type="button" id="${this.$id}-dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false" aria-describedby="${this.$id}-help" ${attrs}><%= label%></button>
      <% if (help) { %><small id="${this.$id}-help" class="form-text text-muted">${help}</small><% } %>
      <div class="dropdown-menu" aria-labelledby="${this.$id}-dropdownMenuButton1">
        <slot></slot>
      </div>
    </div>
  <% } else { %>
    Incorrect input field type
  <% } %>
  <script $onrender $oninput>
    if (this.matches('[type="textarea"]'))
      this.querySelector('.word-count').textContent = this.querySelector('textarea').value.length
  </script>
</template>


<template $name="bs5-input2" name="" type="text" label="" placeholder="" bs5-class="" maxlength:number="" default="" media=""
  items:js="[]" height="auto" help="" html-content="" prefix="" suffix="" layout="">
  <script type="text/html" $block="inputTemplate">
    <% let attrs = [
      this.hasAttribute('disabled') ? 'disabled' : '',
      this.hasAttribute('readonly') ? 'readonly' : ''
    ].join(' ') %>
    <% if (type == 'textarea') { %>
      <textarea id="${this.$id}-input" name="<%- name %>" placeholder="<%- placeholder %>" ${attrs}
        class="form-control <%- bs5Class %>" maxlength="<%- maxlength %>" aria-describedby="${this.$id}-help"
        style="background: url('<%- media %>') no-repeat right 5px top 3px; height: <%- height %>">${obj.default}</textarea>
    <% } else if (type == 'select') { %>
      <select id="${this.$id}-input" name="<%- name %>" ${attrs}
        class="form-select <%- bs5Class %>" aria-describedby="${this.$id}-help"
        style="background: url('<%- media %>') no-repeat right 5px top 3px; height: <%- height %>">
        <% for (var i = 0; i < items.length; i++) { %>
          <option value="<%- i %>"><%- items[i] %></option>
        <% } %>
      </select>
    <% } else if (type.match(/checkbox|radio/)) { %>
      <!-- TODO -- working on this -->
      <% } %>
    <% } else { %>
      <input type="<%- type %>" id="${this.$id}-input" name="<%- name %>" placeholder="<%- placeholder %>" ${attrs} value="<%- obj.default %>"
        class="form-control <%- bs5Class %>" maxlength="<%- maxlength %>" aria-describedby="${this.$id}-help"
        style="background: url('<%- media %>') no-repeat right 5px top 3px; height: <%- height %>"/>
    <% } %>
  </script>
  <% if (layout == 'horizontal') { %>
    <div class="row">
      <label for="${this.$id}-input" class="col-sm-2 col-form-label">${label}</label>
      <div class="col-sm-10">
        <div class="input-group">
          <% if (prefix) { %><span class="input-group-text">${prefix}</span><% } %>
          <%= inputTemplate() %>
          <% if (suffix) { %><span class="input-group-text">${suffix}</span><% } %>
        </div>
      </div>
    </div>
  <% } else if (layout == 'floating') { %>
    <div class="form-floating">
      <%= inputTemplate() %>
      <label for="${this.$id}-input">${label}</label>
    </div>
  <% } else { %>
    <div>
      <label for="${this.$id}-input" class="form-label">${label}</label>
      <div class="input-group">
        <% if (prefix) { %><span class="input-group-text">${prefix}</span><% } %>
        <%= inputTemplate() %>
        <% if (suffix) { %><span class="input-group-text">${suffix}</span><% } %>
      </div>
    </div>
  <% } %>
  <% if (help) { %><small id="${this.$id}-help" class="form-text text-muted">${help}</small><% } %>
</template>
