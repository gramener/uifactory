<template component="svg-chart" src:url="" rules:url="" data:js="{}">
  <%= src && src.text ? uifactory.svgChart(this, src.text, rules, data) : this.innerHTML %>

  <script type="application/javascript">
    uifactory.svgChart = function (self, src, rules, data) {
      const parser = new DOMParser()
      const doc = parser.parseFromString(src, 'image/svg+xml')
      if (rules)
        for (let [selector, attrs] of Object.entries(rules)) {
          let selection = Array.from(doc.querySelectorAll(selector))
          for (let [attr, value] of Object.entries(attrs)) {
            selection.forEach((node, index) => node.setAttribute(attr, typeof value == 'function' ? value.bind(node)(data, index) : value))
          }
        }
      const serializer = new XMLSerializer()
      return serializer.serializeToString(doc)
    }
  </script>
</template>
